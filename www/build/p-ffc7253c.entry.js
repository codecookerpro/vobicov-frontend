import{r as t,h as e,c as s}from"./p-f64a55b6.js";import{K as i}from"./p-8f46979b.js";const o=class{constructor(o){t(this,o),this.inputId=null,this.classes="",this.label="",this.selectedOption=null,this.required=!1,this.errorMessage="",this.statusNoResults="No results",this.statusResultsFound="results found",this.options=[],this.inputValue="",this.isMenuHidden=!0,this.selectedValue="",this.activeOptionIndex=null,this.filteredOptions=[],this.hasError=!1,this.autocompleteOptionIdPrefix="autocomplete-option",this.resetMenuState=()=>{this.isMenuHidden=!0,this.filteredOptions=[],this.activeOptionIndex=null},this.filterForMatches=(t,e="dataAlt")=>this.options.filter(s=>s[e].toString().trim().toLowerCase().indexOf(t)>-1),this.onInputTextType=()=>{let t=this.inputValue.trim().toLowerCase();t.length>0?(this.filteredOptions=this.filterForMatches(t),this.isMenuHidden=!1):(this.selectedValue="",this.selectedValueChangedHandler(null),this.resetMenuState())},this.onInputTextDownPressed=()=>{let t=this.inputValue.trim().toLowerCase();this.filteredOptions=0===t.length?[...this.options]:this.filterForMatches(t,"text"),this.activeOptionIndex=0,this.isMenuHidden=!1,setTimeout(()=>this.autocompleteMenuElement.querySelector("li").focus(),0)},this.onInputTextKeyDown=t=>{i.isTab(t)&&(this.selectOptionOnFocusOut(),this.resetMenuState())},this.onInputTextChange=t=>{this.inputValue=t.target.value},this.onInputTextClick=()=>{this.filteredOptions=[...this.options],this.isMenuHidden=!1},this.onInputTextKeyUp=t=>{i.isEsc(t)||i.isUp(t)||i.isLeft(t)||i.isRight(t)||i.isSpace(t)||i.isEnter(t)||i.isTab(t)||i.isShift(t)||(i.isDown(t)?this.onInputTextDownPressed():this.onInputTextType())},this.onDropdownButtonClick=()=>{this.onInputTextClick(),this.activeOptionIndex=0,setTimeout(()=>{this.autocompleteMenuElement.querySelector("li").focus()},0)},this.selectOption=t=>{this.hasError=!1,this.d4lInputElement&&this.d4lInputElement.querySelector("input").setCustomValidity(""),this.selectedValue=t.value,this.selectedValueChangedHandler(t.id),this.inputValue=t.text,this.isMenuHidden=!0},this.selectOptionOnFocusOut=()=>{const{errorMessage:t,filteredOptions:e,required:s}=this,i=this.inputValue.trim().toLowerCase();i.length&&1===e.length&&e[0].text.trim().toLowerCase().includes(i)&&this.selectOption(e[0]),s&&""===this.selectedValue&&(this.hasError=!0,this.d4lInputElement.querySelector("input").setCustomValidity(t))},this.onOptionUpArrow=t=>{t.preventDefault(),0===this.activeOptionIndex?(this.resetMenuState(),this.autoCompleteInputTextElement.focus()):(this.activeOptionIndex--,t.target.previousElementSibling.focus())},this.onOptionDownArrow=t=>{t.preventDefault(),this.filteredOptions.length-1>this.activeOptionIndex&&(this.activeOptionIndex++,t.target.nextElementSibling.focus())},this.onOptionEscape=()=>{this.resetMenuState(),this.autoCompleteInputTextElement.focus()},this.onMenuKeyDown=t=>{if(i.isUp(t))this.onOptionUpArrow(t);else if(i.isDown(t))this.onOptionDownArrow(t);else if(i.isEnter(t))this.selectOption(this.filteredOptions[this.activeOptionIndex]);else if(i.isSpace(t))this.selectOption(this.filteredOptions[this.activeOptionIndex]);else{if(!i.isEsc(t))return i.isTab(t)?(this.selectOptionOnFocusOut(),void this.resetMenuState()):void this.autoCompleteInputTextElement.focus();this.onOptionEscape()}},this.renderListItems=()=>{const{selectOption:t,activeOptionIndex:s,autocompleteOptionIdPrefix:i,filteredOptions:o}=this;return o.map((o,l)=>e("li",{id:`${i}-${l}`,tabindex:"-1","aria-selected":(s===l).toString(),role:"option",onClick:()=>t(o)},o.text))},this.selectedValueChanged=s(this,"selectedValueChanged",7)}onChangeSelectedOption(t,e){t!==e&&this.selectOption(t)}selectedValueChangedHandler(t){this.selectedValueChanged.emit({key:t,value:this.selectedValue})}get status(){return this.filteredOptions.length?`${this.filteredOptions.length} ${this.statusResultsFound}`:this.statusNoResults}componentWillLoad(){const{selectedOption:t}=this;t&&this.selectOption(t)}componentDidLoad(){this.autoCompleteInputTextElement=this.autocompleteElement.querySelector("input[role=combobox]")}handleDocumentClick(t){const{autocompleteElement:e}=this;e&&e!==t.target&&!e.contains(t.target)&&(this.selectOptionOnFocusOut(),this.resetMenuState())}render(){const{inputId:t,classes:s,label:i,required:o,inputValue:l,options:h,status:a,selectedValue:n,isMenuHidden:c,filteredOptions:r,onInputTextChange:p,onInputTextKeyUp:u,onInputTextKeyDown:d,onInputTextClick:m,onDropdownButtonClick:b,onMenuKeyDown:x,statusNoResults:f,renderListItems:g,hasError:w}=this;return e("div",{class:`autocomplete ${s}`,ref:t=>this.autocompleteElement=t},e("select",{"aria-hidden":"true",tabindex:"-1"},e("option",null,"Select"),!!h.length&&h.map(t=>e("option",{value:t.value,"data-alt":t.dataAlt,selected:n==t.value},t.text))),e("d4l-input",{"input-id":t,type:"text",error:w,label:i,value:l,role:"combobox",required:o,autocomplete:"off",autocapitalize:"none","aria-autocomplete":"list","aria-expanded":!c,"aria-owns":"autocomplete-options",handleInput:p,handleKeyUp:u,handleKeyDown:d,handleClick:m,ref:t=>this.d4lInputElement=t}),e("button",{type:"button",class:"autocomplete__drowdown-button","aria-label":"Open dropdown menu",onClick:b},e("d4l-icon-arrow",{classes:"icon--extra-small"})),e("ul",{id:"autocomplete-options",role:"listbox",class:c&&"is-hidden",onKeyDown:x,ref:t=>this.autocompleteMenuElement=t},r.length?g():e("li",null,f)),e("div",{class:"autocomplete__status-message","aria-live":"polite",role:"status"},!c&&a))}static get watchers(){return{selectedOption:["onChangeSelectedOption"]}}};o.style=".autocomplete.sc-d4l-autocomplete{position:relative;color:var(--c-primary)}.autocomplete.sc-d4l-autocomplete select.sc-d4l-autocomplete,.autocomplete__status-message.sc-d4l-autocomplete{height:1px;width:1px;overflow:hidden;position:absolute;clip:rect(1px, 1px, 1px, 1px)}.autocomplete.sc-d4l-autocomplete [role='listbox'].sc-d4l-autocomplete{margin:0;padding:0.5em 0;max-height:12em;width:100%;overflow-y:scroll;position:absolute;top:2.3em;list-style:none;z-index:2;-webkit-box-shadow:var(--shadow-soft);box-shadow:var(--shadow-soft);border-bottom-left-radius:4px;border-bottom-right-radius:4px;-webkit-overflow-scrolling:touch;background-color:#fff}.autocomplete.sc-d4l-autocomplete [role='listbox'].sc-d4l-autocomplete>li.sc-d4l-autocomplete{padding:0.5em 1em;outline:0}.autocomplete.sc-d4l-autocomplete [role='option'].sc-d4l-autocomplete:hover,.autocomplete.sc-d4l-autocomplete [role='option'][aria-selected='true'].sc-d4l-autocomplete{background-color:var(--c-gray-lightest)}.autocomplete__drowdown-button.sc-d4l-autocomplete{position:absolute;right:0;top:-2px;padding:10px;background:none;border:0}.is-hidden.sc-d4l-autocomplete{display:none}";export{o as d4l_autocomplete}